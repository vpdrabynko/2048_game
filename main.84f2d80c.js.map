{"version":3,"sources":["scripts/cell.js","scripts/grid.js","scripts/tile.js","scripts/main.js"],"names":["Cell","gridElement","x","y","cell","document","createElement","classList","add","append","tile","setXY","linkedTile","linkedTileForMerge","newTile","isEmpty","hasTileForMerge","value","setValue","removeFromDom","unlinkTileForMerge","getValue","GRID_SIZE","CELLS_COUNT","Grid","cells","i","push","Math","floor","cellsGroupedByColumn","groupCellsByColumn","cellsGroupedByReversedColumn","map","column","reverse","cellsGroupedByRow","groupCellsByRow","cellsGroupedByReversedRow","row","emptyCells","filter","random","length","reduce","groupedCells","Tile","tileElement","style","setProperty","textContent","remove","touchstartX","touchstartY","touchendX","touchendY","gameField","getElementById","grid","score","button","querySelector","scoreElement","startGame","setupNewGame","innerHTML","removeEventListener","addEventListener","forEach","unlinkTile","getRandomEmptyCell","linkTile","setupInputOnce","handleGesture","abs","canMoveLeft","moveLeft","canMoveRight","moveRight","canMoveUp","moveUp","canMoveDown","moveDown","event","changedTouches","screenX","screenY","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","handleInput","e","key","slideTiles","slideTilesInGroup","group","j","cellWithTail","targetCell","canAccept","linkTileForMerge","mergeTiles","window","once","canMove","some","canMoveInGroup","index"],"mappings":"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","file":"main.84f2d80c.js","sourceRoot":"..\\src","sourcesContent":["export class Cell {\n  constructor(gridElement, x, y) {\n    const cell = document.createElement('div');\n\n    cell.classList.add('field-cell');\n    gridElement.append(cell);\n    this.x = x;\n    this.y = y;\n  }\n\n  linkTile(tile) {\n    tile.setXY(this.x, this.y);\n    this.linkedTile = tile;\n  }\n\n  unlinkTile() {\n    this.linkedTile = null;\n  }\n\n  isEmpty() {\n    return !this.linkedTile;\n  }\n\n  linkTileForMerge(tile) {\n    tile.setXY(this.x, this.y);\n    this.linkedTileForMerge = tile;\n  }\n\n  unlinkTileForMerge() {\n    this.linkedTileForMerge = null;\n  }\n\n  hasTileForMerge() {\n    return !!this.linkedTileForMerge;\n  }\n\n  canAccept(newTile) {\n    return this.isEmpty() || (!this.hasTileForMerge()\n      && this.linkedTile.value === newTile.value);\n  }\n\n  mergeTiles() {\n    this.linkedTile.setValue(this.linkedTile.value\n      + this.linkedTileForMerge.value);\n    this.linkedTileForMerge.removeFromDom();\n    this.unlinkTileForMerge();\n  }\n\n  getValue() {\n    return this.linkedTile?.getValue() || 0;\n  }\n}\n","import { Cell } from './cell';\n\nconst GRID_SIZE = 4;\nconst CELLS_COUNT = GRID_SIZE * GRID_SIZE;\n\nexport class Grid {\n  constructor(gridElement) {\n    this.cells = [];\n\n    for (let i = 0; i < CELLS_COUNT; i++) {\n      this.cells.push(\n        new Cell(gridElement, i % GRID_SIZE, Math.floor(i / GRID_SIZE))\n      );\n    }\n\n    this.cellsGroupedByColumn = this.groupCellsByColumn();\n\n    this.cellsGroupedByReversedColumn = this.cellsGroupedByColumn\n      .map(column => [...column].reverse());\n\n    this.cellsGroupedByRow = this.groupCellsByRow();\n\n    this.cellsGroupedByReversedRow = this.cellsGroupedByRow\n      .map(row => [...row].reverse());\n  }\n\n  getRandomEmptyCell() {\n    const emptyCells = this.cells.filter(cell => cell.isEmpty());\n    const randomIndex = Math.floor(Math.random() * emptyCells.length);\n\n    return emptyCells[randomIndex];\n  }\n\n  groupCellsByColumn() {\n    return this.cells.reduce((groupedCells, cell) => {\n      groupedCells[cell.x] = groupedCells[cell.x] || [];\n      groupedCells[cell.x][cell.y] = cell;\n\n      return groupedCells;\n    }, []);\n  }\n\n  groupCellsByRow() {\n    return this.cells.reduce((groupedCells, cell) => {\n      groupedCells[cell.y] = groupedCells[cell.y] || [];\n      groupedCells[cell.y][cell.x] = cell;\n\n      return groupedCells;\n    }, []);\n  }\n}\n","export class Tile {\n  constructor(gridElement) {\n    this.tileElement = document.createElement('div');\n    this.tileElement.classList.add('tile');\n    this.setValue(Math.random() > 0.5 ? 2 : 4);\n    gridElement.append(this.tileElement);\n  }\n\n  setXY(x, y) {\n    this.x = x;\n    this.y = y;\n\n    this.tileElement.style.setProperty('--x', x);\n    this.tileElement.style.setProperty('--y', y);\n  }\n\n  setValue(value) {\n    this.value = value;\n    this.tileElement.textContent = this.value;\n    this.tileElement.classList.add(`tile--${value}`);\n  }\n\n  getValue() {\n    return this.value;\n  }\n\n  removeFromDom() {\n    this.tileElement.remove();\n  }\n}\n","import { Grid } from './grid';\nimport { Tile } from './tile';\n\nconst gameField = document.getElementById('game-field');\n\nconst grid = new Grid(gameField);\n\nlet score = 0;\nconst button = document.querySelector('.button');\nconst scoreElement = document.querySelector('.game-score');\n\nbutton.addEventListener('click', startGame);\n\nfunction startGame() {\n  setupNewGame();\n\n  document.querySelector('.message-start').classList.add('hidden');\n  button.classList.remove('start');\n  button.innerHTML = 'Restart';\n  button.classList.add('restart');\n\n  button.removeEventListener('click', startGame);\n  button.addEventListener('click', setupNewGame);\n}\n\nfunction setupNewGame() {\n  grid.cells.forEach(cell => {\n    if (!cell.isEmpty()) {\n      cell.linkedTile.removeFromDom();\n      cell.unlinkTile();\n    }\n  });\n\n  grid.getRandomEmptyCell().linkTile(new Tile(gameField));\n  grid.getRandomEmptyCell().linkTile(new Tile(gameField));\n\n  setupInputOnce();\n\n  score = 0;\n  scoreElement.innerHTML = score;\n\n  document.querySelector('.message-lose').classList.add('hidden');\n  document.querySelector('.message-win').classList.add('hidden');\n}\n\nlet touchstartX;\nlet touchstartY;\nlet touchendX;\nlet touchendY;\n\ngameField.addEventListener('touchstart', function (event) {\n  touchstartX = event.changedTouches[0].screenX;\n  touchstartY = event.changedTouches[0].screenY;\n}, false);\n\ngameField.addEventListener('touchend', function (event) {\n  touchendX = event.changedTouches[0].screenX;\n  touchendY = event.changedTouches[0].screenY;\n  handleGesture();\n}, false);\n\n\nfunction handleGesture() {\n  if (touchendX < touchstartX && (Math.abs(touchstartX - touchendX) > Math.abs(touchstartY - touchendY))) {\n    if (!canMoveLeft()) {\n      setupInputOnce();\n\n      return;\n    }\n    moveLeft();\n  }\n\n  if (touchendX > touchstartX && (Math.abs(touchstartX - touchendX) > Math.abs(touchstartY - touchendY))) {\n    if (!canMoveRight()) {\n      setupInputOnce();\n\n      return;\n    }\n    moveRight();\n  }\n\n  if (touchendY < touchstartY && (Math.abs(touchstartY - touchendY) > Math.abs(touchstartX - touchendX))) {\n    if (!canMoveUp()) {\n      setupInputOnce();\n\n      return;\n    }\n    moveUp();\n  }\n\n  if (touchendY > touchstartY && (Math.abs(touchstartY - touchendY) > Math.abs(touchstartX - touchendX))) {\n    if (!canMoveDown()) {\n      setupInputOnce();\n\n      return;\n    }\n    moveDown();\n  }\n\n  if (touchendY === touchstartY) {\n    return;\n  }\n\n  if (touchendX === touchstartX) {\n    return;\n  }\n\n  const newTile = new Tile(gameField);\n\n  grid.getRandomEmptyCell().linkTile(newTile);\n\n  if (!canMoveUp() && !canMoveDown() && !canMoveLeft() && !canMoveRight()) {\n    document.querySelector('.message-lose').classList.remove('hidden');\n  }\n\n  setupInputOnce();\n}\n\nconst ARROW_UP = 'ArrowUp';\nconst ARROW_DOWN = 'ArrowDown';\nconst ARROW_LEFT = 'ArrowLeft';\nconst ARROW_RIGHT = 'ArrowRight';\n\nfunction handleInput(e) {\n  switch (e.key) {\n    case ARROW_UP:\n      if (!canMoveUp()) {\n        setupInputOnce();\n\n        return;\n      }\n      moveUp();\n      break;\n\n    case ARROW_DOWN:\n      if (!canMoveDown()) {\n        setupInputOnce();\n\n        return;\n      }\n      moveDown();\n      break;\n\n    case ARROW_LEFT:\n      if (!canMoveLeft()) {\n        setupInputOnce();\n\n        return;\n      }\n      moveLeft();\n      break;\n\n    case ARROW_RIGHT:\n      if (!canMoveRight()) {\n        setupInputOnce();\n\n        return;\n      }\n      moveRight();\n      break;\n\n    default:\n      setupInputOnce();\n\n      return;\n  }\n\n  const newTile = new Tile(gameField);\n\n  grid.getRandomEmptyCell().linkTile(newTile);\n\n  if (!canMoveUp() && !canMoveDown() && !canMoveLeft() && !canMoveRight()) {\n    document.querySelector('.message-lose').classList.remove('hidden');\n  }\n\n  setupInputOnce();\n}\n\nfunction moveUp() {\n  slideTiles(grid.cellsGroupedByColumn);\n}\n\nfunction moveDown() {\n  slideTiles(grid.cellsGroupedByReversedColumn);\n}\n\nfunction moveLeft() {\n  slideTiles(grid.cellsGroupedByRow);\n}\n\nfunction moveRight() {\n  slideTiles(grid.cellsGroupedByReversedRow);\n}\n\nfunction slideTilesInGroup(group) {\n  for (let i = 0; i < group.length; i++) {\n    if (group[i].isEmpty()) {\n      continue;\n    }\n\n    const cellWithTail = group[i];\n\n    let targetCell;\n    let j = i - 1;\n\n    while (j >= 0 && group[j].canAccept(cellWithTail.linkedTile)) {\n      targetCell = group[j];\n      j--;\n    }\n\n    if (!targetCell) {\n      continue;\n    }\n\n    targetCell.isEmpty()\n      ? targetCell.linkTile(cellWithTail.linkedTile)\n      : targetCell.linkTileForMerge(cellWithTail.linkedTile);\n\n    cellWithTail.unlinkTile();\n  }\n}\n\nfunction slideTiles(groupedCells) {\n  groupedCells.forEach(group => slideTilesInGroup(group));\n\n  grid.cells.forEach(cell => {\n    if (cell.hasTileForMerge()) {\n      cell.mergeTiles();\n      score += cell.getValue();\n      scoreElement.innerHTML = score;\n    }\n\n    if (cell.getValue() === 2048) {\n      document.querySelector('.message-win').classList.remove('hidden');\n      window.removeEventListener('keydown');\n    }\n  });\n}\n\nfunction setupInputOnce() {\n  window.addEventListener('keydown', handleInput, { once: true });\n};\n\nfunction canMoveUp() {\n  return canMove(grid.cellsGroupedByColumn);\n}\n\nfunction canMoveDown() {\n  return canMove(grid.cellsGroupedByReversedColumn);\n}\n\nfunction canMoveLeft() {\n  return canMove(grid.cellsGroupedByRow);\n}\n\nfunction canMoveRight() {\n  return canMove(grid.cellsGroupedByReversedRow);\n}\n\nfunction canMove(groupedCells) {\n  return groupedCells.some(group => canMoveInGroup(group));\n}\n\nfunction canMoveInGroup(group) {\n  return group.some((cell, index) => {\n    if (index === 0 || cell.isEmpty()) {\n      return false;\n    }\n\n    const targetCell = group[index - 1];\n\n    return targetCell.canAccept(cell.linkedTile);\n  });\n}\n"]}